const _0x43f6d6=_0x59aa;(function(_0x1a352f,_0x13eb42){const _0x646d7a=_0x59aa,_0x427155=_0x1a352f();while(!![]){try{const _0x2e07c0=parseInt(_0x646d7a(0x106))/0x1+-parseInt(_0x646d7a(0x137))/0x2*(-parseInt(_0x646d7a(0x136))/0x3)+parseInt(_0x646d7a(0x13e))/0x4+-parseInt(_0x646d7a(0x104))/0x5*(parseInt(_0x646d7a(0x126))/0x6)+-parseInt(_0x646d7a(0x107))/0x7*(-parseInt(_0x646d7a(0x105))/0x8)+parseInt(_0x646d7a(0x100))/0x9*(-parseInt(_0x646d7a(0x10b))/0xa)+-parseInt(_0x646d7a(0x119))/0xb;if(_0x2e07c0===_0x13eb42)break;else _0x427155['push'](_0x427155['shift']());}catch(_0x4a185c){_0x427155['push'](_0x427155['shift']());}}}(_0xc028,0x2b218));import{connect}from'cloudflare:sockets';let sha224Password=_0x43f6d6(0x12c),proxyIP='';if(!isValidSHA224(sha224Password))throw new Error(_0x43f6d6(0x12a));const worker_default={async 'fetch'(_0x3fffe4,_0x24087f,_0x284be8){const _0x35628e=_0x43f6d6;try{proxyIP=_0x24087f[_0x35628e(0x12e)]||proxyIP,sha224Password=_0x24087f['SHA224PASS']||sha224Password;const _0x2da821=_0x3fffe4[_0x35628e(0x115)][_0x35628e(0x125)](_0x35628e(0x12b));if(!_0x2da821||_0x2da821!=='websocket'){const _0x584d90=new URL(_0x3fffe4[_0x35628e(0x143)]);switch(_0x584d90[_0x35628e(0x13b)]){case'/link':const _0x17faa5=_0x3fffe4[_0x35628e(0x115)][_0x35628e(0x125)](_0x35628e(0x120));return new Response('trojan://ca110us@'+_0x17faa5+_0x35628e(0x13d)+_0x17faa5+'&security=tls',{'status':0xc8,'headers':{'Content-Type':_0x35628e(0x139)}});default:return new Response(_0x35628e(0x113),{'status':0x194});}}else return await trojanOverWSHandler(_0x3fffe4);}catch(_0x496a36){let _0x13900a=_0x496a36;return new Response(_0x13900a['toString']());}}};async function trojanOverWSHandler(_0x3e20c4){const _0x4b580e=_0x43f6d6,_0x5a32cf=new WebSocketPair(),[_0x5cddfb,_0x5a6c47]=Object[_0x4b580e(0x11e)](_0x5a32cf);_0x5a6c47[_0x4b580e(0x10e)]();let _0x1a2c22='',_0x2ad429='';const _0x4bc85f=(_0x3702f3,_0x372594)=>{const _0x363eea=_0x4b580e;console[_0x363eea(0x128)]('['+_0x1a2c22+':'+_0x2ad429+']\x20'+_0x3702f3,_0x372594||'');},_0xa12cf6=_0x3e20c4[_0x4b580e(0x115)][_0x4b580e(0x125)](_0x4b580e(0x124))||'',_0xb6f19e=makeReadableWebSocketStream(_0x5a6c47,_0xa12cf6,_0x4bc85f);let _0x495125={'value':null},_0x58e9a1=null;return _0xb6f19e[_0x4b580e(0x117)](new WritableStream({async 'write'(_0x1f69f2,_0x11172b){const _0x3a5674=_0x4b580e;if(_0x58e9a1)return _0x58e9a1(_0x1f69f2);if(_0x495125[_0x3a5674(0x114)]){const _0x327a65=_0x495125[_0x3a5674(0x114)][_0x3a5674(0x110)][_0x3a5674(0x134)]();await _0x327a65[_0x3a5674(0xfc)](_0x1f69f2),_0x327a65[_0x3a5674(0xfe)]();return;}const {hasError:_0x236893,message:_0x5544e2,portRemote:portRemote=0x1bb,addressRemote:addressRemote='',rawClientData:_0x2ed375}=await parseTrojanHeader(_0x1f69f2);_0x1a2c22=addressRemote,_0x2ad429=portRemote+'--'+Math['random']()+'\x20tcp';if(_0x236893){throw new Error(_0x5544e2);return;}handleTCPOutBound(_0x495125,addressRemote,portRemote,_0x2ed375,_0x5a6c47,_0x4bc85f);},'close'(){const _0x591051=_0x4b580e;_0x4bc85f(_0x591051(0x129));},'abort'(_0x1312fc){const _0x12ccb2=_0x4b580e;_0x4bc85f('readableWebSocketStream\x20is\x20aborted',JSON[_0x12ccb2(0x121)](_0x1312fc));}}))[_0x4b580e(0x135)](_0x1f0f94=>{const _0x557734=_0x4b580e;_0x4bc85f(_0x557734(0x11a),_0x1f0f94);}),new Response(null,{'status':0x65,'webSocket':_0x5cddfb});}async function parseTrojanHeader(_0x36be67){const _0x4cd5d1=_0x43f6d6;if(_0x36be67['byteLength']<0x38)return{'hasError':!![],'message':_0x4cd5d1(0x103)};let _0x181b23=0x38;if(new Uint8Array(_0x36be67[_0x4cd5d1(0x111)](0x38,0x39))[0x0]!==0xd||new Uint8Array(_0x36be67[_0x4cd5d1(0x111)](0x39,0x3a))[0x0]!==0xa)return{'hasError':!![],'message':_0x4cd5d1(0x11b)};const _0x283ae8=new TextDecoder()[_0x4cd5d1(0x11d)](_0x36be67[_0x4cd5d1(0x111)](0x0,_0x181b23));if(_0x283ae8!==sha224Password)return{'hasError':!![],'message':_0x4cd5d1(0x123)};const _0x53fe8a=_0x36be67['slice'](_0x181b23+0x2);if(_0x53fe8a[_0x4cd5d1(0x132)]<0x6)return{'hasError':!![],'message':'invalid\x20SOCKS5\x20request\x20data'};const _0x28c60d=new DataView(_0x53fe8a),_0x4e61da=_0x28c60d['getUint8'](0x0);if(_0x4e61da!==0x1)return{'hasError':!![],'message':_0x4cd5d1(0x116)};const _0x4e0dcd=_0x28c60d[_0x4cd5d1(0x10a)](0x1);let _0x370aa1=0x0,_0x13256f=0x2,_0x5aa17e='';switch(_0x4e0dcd){case 0x1:_0x370aa1=0x4,_0x5aa17e=new Uint8Array(_0x53fe8a[_0x4cd5d1(0x111)](_0x13256f,_0x13256f+_0x370aa1))[_0x4cd5d1(0x122)]('.');break;case 0x3:_0x370aa1=new Uint8Array(_0x53fe8a[_0x4cd5d1(0x111)](_0x13256f,_0x13256f+0x1))[0x0],_0x13256f+=0x1,_0x5aa17e=new TextDecoder()[_0x4cd5d1(0x11d)](_0x53fe8a[_0x4cd5d1(0x111)](_0x13256f,_0x13256f+_0x370aa1));break;case 0x4:_0x370aa1=0x10;const _0x1fc69e=new DataView(_0x53fe8a[_0x4cd5d1(0x111)](_0x13256f,_0x13256f+_0x370aa1)),_0x49f5de=[];for(let _0x4e46d1=0x0;_0x4e46d1<0x8;_0x4e46d1++){_0x49f5de['push'](_0x1fc69e['getUint16'](_0x4e46d1*0x2)[_0x4cd5d1(0x118)](0x10));}_0x5aa17e=_0x49f5de[_0x4cd5d1(0x122)](':');break;default:return{'hasError':!![],'message':_0x4cd5d1(0x13c)+_0x4e0dcd};}if(!_0x5aa17e)return{'hasError':!![],'message':'address\x20is\x20empty,\x20addressType\x20is\x20'+_0x4e0dcd};const _0x2eee78=_0x13256f+_0x370aa1,_0x3b15d4=_0x53fe8a[_0x4cd5d1(0x111)](_0x2eee78,_0x2eee78+0x2),_0x5379bc=new DataView(_0x3b15d4)['getUint16'](0x0);return{'hasError':![],'addressRemote':_0x5aa17e,'portRemote':_0x5379bc,'rawClientData':_0x53fe8a[_0x4cd5d1(0x111)](_0x2eee78+0x4)};}function _0x59aa(_0x58f78d,_0x2ccb79){const _0xc028fa=_0xc028();return _0x59aa=function(_0x59aa2d,_0x5597ed){_0x59aa2d=_0x59aa2d-0xfc;let _0x3fe6c8=_0xc028fa[_0x59aa2d];return _0x3fe6c8;},_0x59aa(_0x58f78d,_0x2ccb79);}async function handleTCPOutBound(_0x47d514,_0x1250e3,_0x208cc1,_0x47f4ba,_0x2d8690,_0x5760e0){async function _0x9cc765(_0x1f8c06,_0x3b1d41){const _0x588934=_0x59aa,_0x207f19=connect({'hostname':_0x1f8c06,'port':_0x3b1d41});_0x47d514[_0x588934(0x114)]=_0x207f19,_0x5760e0(_0x588934(0x133)+_0x1f8c06+':'+_0x3b1d41);const _0x22d9d5=_0x207f19[_0x588934(0x110)][_0x588934(0x134)]();return await _0x22d9d5['write'](_0x47f4ba),_0x22d9d5['releaseLock'](),_0x207f19;}async function _0x99bc84(){const _0x4390d0=_0x59aa,_0x13694a=await _0x9cc765(proxyIP||_0x1250e3,_0x208cc1);_0x13694a[_0x4390d0(0x112)][_0x4390d0(0x135)](_0x2bc63b=>{const _0x41acdc=_0x4390d0;console[_0x41acdc(0x128)](_0x41acdc(0x12d),_0x2bc63b);})[_0x4390d0(0x11f)](()=>{safeCloseWebSocket(_0x2d8690);}),remoteSocketToWS(_0x13694a,_0x2d8690,null,_0x5760e0);}const _0x58b092=await _0x9cc765(_0x1250e3,_0x208cc1);remoteSocketToWS(_0x58b092,_0x2d8690,_0x99bc84,_0x5760e0);}function makeReadableWebSocketStream(_0x394fc8,_0xa976dc,_0x596f02){let _0x2a43ad=![];const _0x4fde1b=new ReadableStream({'start'(_0x41b020){const _0x47da2e=_0x59aa;_0x394fc8[_0x47da2e(0x140)](_0x47da2e(0x13f),_0x1363a6=>{const _0xe7a7c5=_0x47da2e;if(_0x2a43ad)return;const _0x55c980=_0x1363a6[_0xe7a7c5(0x10c)];_0x41b020[_0xe7a7c5(0x10d)](_0x55c980);}),_0x394fc8['addEventListener'](_0x47da2e(0x142),()=>{safeCloseWebSocket(_0x394fc8);if(_0x2a43ad)return;_0x41b020['close']();}),_0x394fc8[_0x47da2e(0x140)](_0x47da2e(0x141),_0x139d9f=>{const _0x2424bf=_0x47da2e;_0x596f02(_0x2424bf(0x101)),_0x41b020[_0x2424bf(0x141)](_0x139d9f);});const {earlyData:_0x42e647,error:_0x18f1a0}=base64ToArrayBuffer(_0xa976dc);if(_0x18f1a0)_0x41b020['error'](_0x18f1a0);else _0x42e647&&_0x41b020[_0x47da2e(0x10d)](_0x42e647);},'pull'(_0x5a9c06){},'cancel'(_0x3fc7ef){const _0x58ff28=_0x59aa;if(_0x2a43ad)return;_0x596f02(_0x58ff28(0x127)+_0x3fc7ef),_0x2a43ad=!![],safeCloseWebSocket(_0x394fc8);}});return _0x4fde1b;}async function remoteSocketToWS(_0x24e350,_0x897e66,_0x7bdfdb,_0x1ae310){const _0x4cd402=_0x43f6d6;let _0x24e375=![];await _0x24e350[_0x4cd402(0x10f)][_0x4cd402(0x117)](new WritableStream({'start'(){},async 'write'(_0x212819,_0x16d627){const _0x148d39=_0x4cd402;_0x24e375=!![],_0x897e66[_0x148d39(0x131)]!==WS_READY_STATE_OPEN&&_0x16d627['error']('webSocket\x20connection\x20is\x20not\x20open'),_0x897e66['send'](_0x212819);},'close'(){const _0x31ced5=_0x4cd402;_0x1ae310(_0x31ced5(0x109)+_0x24e375);},'abort'(_0x3deefb){const _0x193ee3=_0x4cd402;console[_0x193ee3(0x141)](_0x193ee3(0xff),_0x3deefb);}}))[_0x4cd402(0x135)](_0x49c4c6=>{const _0x348047=_0x4cd402;console[_0x348047(0x141)]('remoteSocketToWS\x20error:',_0x49c4c6[_0x348047(0x108)]||_0x49c4c6),safeCloseWebSocket(_0x897e66);}),_0x24e375===![]&&_0x7bdfdb&&(_0x1ae310(_0x4cd402(0x130)),_0x7bdfdb());}function _0xc028(){const _0x273c46=['invalid\x20data','5vMiUXm','11936HypBIR','319751poWMBc','336tSOyms','stack','remoteSocket.readable\x20is\x20closed,\x20hasIncomingData:\x20','getUint8','80yrTiAr','data','enqueue','accept','readable','writable','slice','closed','404\x20Not\x20found','value','headers','unsupported\x20command,\x20only\x20TCP\x20(CONNECT)\x20is\x20allowed','pipeTo','toString','15818HCFqqw','readableWebSocketStream\x20pipeTo\x20error','invalid\x20header\x20format\x20(missing\x20CR\x20LF)','buffer','decode','values','finally','Host','stringify','join','invalid\x20password','sec-websocket-protocol','get','2110674wGLEpK','readableStream\x20was\x20canceled,\x20due\x20to\x20','log','readableWebSocketStream\x20is\x20closed','sha224Password\x20is\x20not\x20valid','Upgrade','08f32643dbdacf81d0d511f1ee24b06de759e90f8edf742bbdc57d88','retry\x20tcpSocket\x20closed\x20error','PROXYIP','safeCloseWebSocket\x20error','retry','readyState','byteLength','connected\x20to\x20','getWriter','catch','4989SsLZqp','194JkqvYU','replace','text/plain;charset=utf-8','test','pathname','invalid\x20addressType\x20is\x20',':443/?type=ws&host=','568620urTYuX','message','addEventListener','error','close','url','write','from','releaseLock','remoteSocket.readable\x20abort','185571FpIPSJ','webSocketServer\x20error','charCodeAt'];_0xc028=function(){return _0x273c46;};return _0xc028();}function isValidSHA224(_0x35c781){const _0x568437=_0x43f6d6,_0x1dcce2=/^[0-9a-f]{56}$/i;return _0x1dcce2[_0x568437(0x13a)](_0x35c781);}function base64ToArrayBuffer(_0x1919dd){const _0x31ec1f=_0x43f6d6;if(!_0x1919dd)return{'error':null};try{_0x1919dd=_0x1919dd[_0x31ec1f(0x138)](/-/g,'+')[_0x31ec1f(0x138)](/_/g,'/');const _0x124bf5=atob(_0x1919dd),_0x5adba4=Uint8Array[_0x31ec1f(0xfd)](_0x124bf5,_0x217f77=>_0x217f77[_0x31ec1f(0x102)](0x0));return{'earlyData':_0x5adba4[_0x31ec1f(0x11c)],'error':null};}catch(_0x2aee9f){return{'error':_0x2aee9f};}}let WS_READY_STATE_OPEN=0x1,WS_READY_STATE_CLOSING=0x2;function safeCloseWebSocket(_0x42ae20){const _0x56f66c=_0x43f6d6;try{(_0x42ae20[_0x56f66c(0x131)]===WS_READY_STATE_OPEN||_0x42ae20[_0x56f66c(0x131)]===WS_READY_STATE_CLOSING)&&_0x42ae20['close']();}catch(_0x2dbe1a){console['error'](_0x56f66c(0x12f),_0x2dbe1a);}}export{worker_default as default};
